<flow xmlns="http://www.springframework.org/schema/webflow"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

  <on-start>
    <evaluate expression="orderService.newAddress()" result="flowScope.address" />
  </on-start>

  <view-state id="enterAddress" model="address" view="address">
    <transition on="submit" to="choosePayment" />
  </view-state>

  <view-state id="choosePayment" view="payment">
    <transition on="submit" to="confirmOrder" />
  </view-state>

  <view-state id="confirmOrder" view="review">
    <transition on="submit" to="orderPlaced" />
    <transition on="reviseAddress" to="enterAddress" />
    <transition on="revisePayment" to="choosePayment" />
    <transition on="cancel" to="orderCancelled" />
  </view-state>

  <end-state id="orderPlaced" view="final">
    <output name="orderId" value="order.id" />
  </end-state>

  <end-state id="orderCancelled" />
</flow>